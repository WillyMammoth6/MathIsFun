<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Math Zoo</title>
    <style>
        /* --- RESET & BASE STYLES --- */
        * {
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: #121212; /* Dark Theme */
            color: #ffffff;
            font-family: 'Comic Sans MS', 'Chalkboard SE', sans-serif;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #app {
            width: 100%;
            max-width: 600px;
            height: 100%;
            position: relative;
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .hidden { display: none !important; }

        .screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            text-align: center;
            animation: fadeIn 0.5s ease-out;
            position: absolute;
            top: 0;
            left: 0;
        }

        /* --- TYPOGRAPHY --- */
        h1 {
            font-size: 3rem;
            color: #FFD700;
            text-shadow: 2px 2px 0px #d35400;
            margin-bottom: 20px;
        }
        h2 { font-size: 2rem; margin-bottom: 10px; }
        p { font-size: 1.2rem; color: #bdc3c7; }

        /* --- BUTTONS --- */
        button {
            border: none;
            outline: none;
            cursor: pointer;
            font-family: inherit;
            font-weight: bold;
            box-shadow: 0 4px 0 rgba(0,0,0,0.4);
            transition: transform 0.1s;
        }
        button:active { transform: translateY(4px); box-shadow: none; }

        .btn-large {
            font-size: 1.5rem;
            padding: 15px 40px;
            border-radius: 50px;
            margin: 10px;
            width: 80%;
            max-width: 300px;
        }
        .btn-easy { background-color: #2ecc71; color: white; }
        .btn-hard { background-color: #e74c3c; color: white; }
        .btn-restart { background-color: #3498db; color: white; }
        .btn-manage { background-color: #9b59b6; color: white; font-size: 1rem; padding: 10px 20px; border-radius: 12px; margin-top:15px; }

        /* --- GAMEPLAY UI --- */
        .hud {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 1.5rem;
            color: #f1c40f;
            font-weight: bold;
            background: rgba(255,255,255,0.1);
            padding: 5px 15px;
            border-radius: 15px;
        }

        .question-box {
            background-color: #2c3e50;
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            width: 100%;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            border: 4px solid #34495e;
        }

        .question-text {
            font-size: 4rem;
            font-weight: bold;
            color: #ecf0f1;
        }

        .answers-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            width: 100%;
        }

        .answer-btn {
            background-color: #8e44ad;
            color: white;
            font-size: 2.5rem;
            padding: 20px;
            border-radius: 15px;
        }
        .answer-btn:active { background-color: #9b59b6; }

        .feedback-msg {
            color: #e74c3c;
            font-size: 1.5rem;
            margin-top: 20px;
            font-weight: bold;
            min-height: 1.5em;
            animation: shake 0.5s;
        }

        /* --- ANIMAL REWARD --- */
        #feedback-screen {
            position: absolute;
            top: 0;
            left: 0;
            z-index: 100;
            background: rgba(0,0,0,0.95);
        }

        .animal-img {
            max-width: 90%;
            max-height: 55vh;
            border-radius: 20px;
            border: 5px solid #fff;
            box-shadow: 0 0 20px rgba(255,255,255,0.2);
            object-fit: cover;
            background-color: #333;
        }

        .praise-text {
            font-size: 3rem;
            color: #2ecc71;
            margin-top: 20px;
            font-weight: bold;
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        /* --- DIAGNOSTIC SCREEN --- */
        #diagnostic-screen {
            overflow-y: auto;
            justify-content: flex-start;
            padding-top: 20px;
            background: #1a1a1a;
        }
        
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 5px;
            width: 100%;
            padding: 10px;
        }

        .gallery-item {
            aspect-ratio: 1;
            width: 100%;
            background: #333;
            border-radius: 4px;
            position: relative;
            overflow: hidden;
            border: 2px solid transparent;
        }

        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .gallery-item.good { border-color: #2ecc71; }
        .gallery-item.bad { border-color: #e74c3c; opacity: 0.3; }
        
        .status-bar {
            position: sticky;
            top: 0;
            background: #2c3e50;
            width: 100%;
            padding: 10px;
            z-index: 10;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes popIn { from { transform: scale(0); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
            100% { transform: translateX(0); }
        }
    </style>
</head>
<body>

<div id="app">
    
    <!-- TITLE SCREEN -->
    <div id="title-screen" class="screen">
        <h1>Math Zoo 3.0 ü¶Å</h1>
        <p>Pick a difficulty to start!</p>
        <br>
        <button class="btn-large btn-easy" onclick="game.startGame('easy')">Easy üôÇ</button>
        <button class="btn-large btn-hard" onclick="game.startGame('hard')">Hard üòé</button>
        <br>
        <button class="btn-manage" onclick="game.openDiagnostics()">üîß Manage Zoo</button>
    </div>

    <!-- DIAGNOSTIC SCREEN -->
    <div id="diagnostic-screen" class="screen hidden">
        <div class="status-bar">
            <div>Working Images: <span id="diag-count" style="color:#2ecc71">0</span></div>
            <button class="btn-restart" style="padding: 5px 20px; font-size: 1rem;" onclick="game.resetToTitle()">Return to Title</button>
        </div>
        <div class="gallery-grid" id="gallery-container"></div>
    </div>

    <!-- GAME SCREEN -->
    <div id="game-screen" class="screen hidden">
        <div class="hud">Score: <span id="score-display">0</span></div>
        <div class="question-box">
            <div class="question-text" id="question-text">1 + 1 = ?</div>
        </div>
        <div class="answers-grid" id="answers-container"></div>
        
        <!-- NEW FEEDBACK MESSAGE -->
        <div id="feedback-msg" class="feedback-msg hidden">Oops, try again! üòÖ</div>

        <p style="margin-top:20px; opacity: 0.5;">Question <span id="q-count">1</span> / 10</p>
    </div>

    <!-- REWARD SCREEN -->
    <div id="feedback-screen" class="screen hidden">
        <img id="animal-display" class="animal-img" src="" alt="Cute Animal" onerror="game.handleImageError(this)">
        <div class="praise-text">Correct!</div>
    </div>

    <!-- END SCREEN -->
    <div id="end-screen" class="screen hidden">
        <h1>Great Job!</h1>
        <h2>Your Score</h2>
        <h1 style="font-size: 5rem; color: #2ecc71;" id="final-score">0</h1>
        <p>You answered 10 questions!</p>
        <br>
        <button class="btn-large btn-restart" onclick="game.resetToTitle()">Play Again üîÑ</button>
    </div>

</div>

<script>
const game = {
    maxQuestions: 10,
    score: 0,
    questionNumber: 0,
    difficulty: 'easy',
    currentQuestion: null,
    isProcessing: false,
    
    // Track if user missed the current question (for scoring purposes)
    firstAttempt: true,

    activeImages: [], 

    sourceImages: [
        // AXOLOTLS (10)
        "https://upload.wikimedia.org/wikipedia/commons/thumb/2/26/202501_Axolotl.svg/960px-202501_Axolotl.svg.png",
        "https://upload.wikimedia.org/wikipedia/commons/thumb/1/16/Ambystoma_mexicanum_photo.jpg/960px-Ambystoma_mexicanum_photo.jpg",

        // --- DOGS & PUPPIES ---
        "https://images.unsplash.com/photo-1591160690555-5debfba289f0?w=600&q=80",
        "https://images.unsplash.com/photo-1543466835-00a7907e9de1?w=600&q=80",
        "https://images.unsplash.com/photo-1583511655857-d19b40a7a54e?w=600&q=80",
        "https://images.unsplash.com/photo-1588943211346-0908a1fb0b01?w=600&q=80",
        "https://images.unsplash.com/photo-1517423440428-a5a00ad493e8?w=600&q=80",
        "https://images.unsplash.com/photo-1507146426996-ef05306b995a?w=600&q=80",
        "https://images.unsplash.com/photo-1561037404-61cd46aa615b?w=600&q=80",
        "https://images.unsplash.com/photo-1548199973-03cce0bbc87b?w=600&q=80",
        "https://images.unsplash.com/photo-1552053831-71594a27632d?w=600&q=80",
        "https://images.unsplash.com/photo-1537151608828-ea2b11777ee8?w=600&q=80",

        // --- KITTENS ---
        "https://images.unsplash.com/photo-1514888286974-6c03e2ca1dba?w=600&q=80",
        "https://images.unsplash.com/photo-1573865526739-10659fec78a5?w=600&q=80",
        "https://images.unsplash.com/photo-1533738363-b7f9aef128ce?w=600&q=80",
        "https://images.unsplash.com/photo-1513360371669-4adf3dd7dff8?w=600&q=80",
        "https://images.unsplash.com/photo-1526336024174-e58f5cdd8e13?w=600&q=80",
        "https://images.unsplash.com/photo-1519052537078-e6302a4968d4?w=600&q=80",
        "https://images.unsplash.com/photo-1501820488136-72669149e0d4?w=600&q=80",
        "https://images.unsplash.com/photo-1506755855567-92ff770e8d00?w=600&q=80",

        // --- RED PANDAS & BEARS ---
        "https://images.unsplash.com/photo-1570288685280-7802a8f8c4fa?w=600&q=80",
        "https://images.unsplash.com/photo-1564349683136-77e08dba1ef7?w=600&q=80",
        "https://images.unsplash.com/photo-1501686637-b7aa9c48a882?w=600&q=80",
        "https://images.unsplash.com/photo-1526716173434-a1b560f2065d?w=600&q=80",

        // --- BUNNIES & SMALL ANIMALS ---
        "https://images.unsplash.com/photo-1555685812-4b943f1cb0eb?w=600&q=80",
        "https://images.unsplash.com/photo-1591382386627-349b692688ff?w=600&q=80",
        
        // --- FOXES ---
        "https://images.unsplash.com/photo-1516934024742-b461fba47600?w=600&q=80",
        "https://images.unsplash.com/photo-1474511320723-9a56873867b5?w=600&q=80",
        
        // --- EXTRA CUTE MIX ---
        "https://images.unsplash.com/photo-1576201836106-db1758fd1c97?w=600&q=80",
        "https://images.unsplash.com/photo-1560807707-8cc77767d783?w=600&q=80",
        "https://images.unsplash.com/photo-1534361960057-19889db9621e?w=600&q=80",
        "https://images.unsplash.com/photo-1518020382113-a7e8fc38eac9?w=600&q=80",
        "https://images.unsplash.com/photo-1583337130417-3346a1be7dee?w=600&q=80",
        "https://images.unsplash.com/photo-1601758177266-bc599de87707?w=600&q=80",
        "https://images.unsplash.com/photo-1555169062-013468b47731?w=600&q=80",

        // --- From Grok ---
        "https://images.unsplash.com/photo-1560114928-40f1f1eb26a0",
        "https://images.unsplash.com/photo-1518791841217-8f162f1e1131",
        "https://images.unsplash.com/photo-1514888286974-6c03e2ca1dba",
        "https://images.unsplash.com/photo-1534361960057-19889db9621e",
        "https://images.unsplash.com/photo-1507146426996-ef05306b995a",
        "https://images.unsplash.com/photo-1701532420819-b6c28840ce05",
        "https://images.unsplash.com/photo-1500621242946-fc62f4875073",
        "https://images.unsplash.com/photo-1500479694472-551d1fb6258d",
        "https://images.unsplash.com/photo-1620576537654-089e6620b4ea",
        "https://images.unsplash.com/photo-1517837543704-3617ae61a835",
        "https://images.unsplash.com/photo-1726335849092-a9870a096165",
        "https://images.unsplash.com/photo-1635922511024-5ea80c617b78",
        "https://images.unsplash.com/photo-1604417389023-3018ace0afbf",
        "https://images.unsplash.com/photo-1528359645462-5ff224bf906e",
        "https://images.unsplash.com/photo-1540126034813-121bf29033d2",
        "https://images.unsplash.com/photo-1538099023053-30e7da644196",
        "https://images.unsplash.com/photo-1663869172866-7f13e4977be8",
        "https://images.unsplash.com/photo-1597953601374-1ff2d5640c85",
        "https://images.unsplash.com/photo-1712979242477-5cdd2ac07fa5",
        "https://images.unsplash.com/photo-1617398881039-4c977f633b0e",
        "https://images.unsplash.com/photo-1628067611203-a24e1cc77de5",
        "https://images.unsplash.com/photo-1591561582301-7ce6588cc286",
        "https://images.unsplash.com/photo-1538640206218-edd12e7624fc",
        "https://images.unsplash.com/photo-1533651180995-3b8dcd33e834",
        "https://images.unsplash.com/photo-1555281614-8d58d2611325",
        "https://images.unsplash.com/photo-1596376769765-3727dd84f9b5",
        "https://images.unsplash.com/photo-1635384280816-5b841263863c",
        "https://images.unsplash.com/photo-1599557180413-b3904af41411",
        "https://images.unsplash.com/photo-1568431477192-52bb13a55088",
        "https://images.unsplash.com/photo-1605369179729-4036b4d829cb",
        "https://images.unsplash.com/photo-1534278931827-8a259344abe7",
        "https://images.unsplash.com/photo-1604961838276-1b74540214c0",
        "https://images.unsplash.com/photo-1727098686140-c38eee077281",
        "https://images.unsplash.com/photo-1721833144160-1bb72d04ff4c",
        "https://images.unsplash.com/photo-1698435354379-b10bcc803369",
        "https://images.unsplash.com/photo-1722340029062-6a6f3b934c40",
        "https://images.unsplash.com/photo-1705331061640-dc2eab910b74",
        "https://images.unsplash.com/photo-1731673883639-f2b27d5cd797",
        "https://images.unsplash.com/photo-1577021121271-de79349d7191",
        "https://images.unsplash.com/photo-1577021307655-7f9785f40e2d",
        "https://images.unsplash.com/photo-1569247625012-49e746e882e1",
        "https://images.unsplash.com/photo-1532341822085-6f3386f2bfa3",
        "https://images.unsplash.com/photo-1719433203940-a9329d15d3e9",

        "https://cdn.hswstatic.com/gif/gettyimages-85120553.jpg",
        "https://www.rd.com/wp-content/uploads/2021/04/GettyImages-1145794687.jpg",
        "https://i.ytimg.com/vi/NGC8IS4gjpM/maxresdefault.jpg",
        "https://c02.purpledshub.com/uploads/sites/41/2024/05/fennec-fox-Vulpes-zerda.jpg?webp=1&w=1200",
        "https://loveincorporated.blob.core.windows.net/contentimages/gallery/99eb0506-1111-4347-9c42-293bc9cbdc2d-panda-worlds-cutest-baby-animals-ranked.jpg",
        "https://parade.com/.image/w_3840,q_auto:good,c_limit/MTkwNTc4ODA5NzQwNjAwNDQ1/fennec-fox.jpg?arena_f_auto",
        "https://images.squarespace-cdn.com/content/v1/55ee34aae4b0bf70212ada4c/1573837850710-HQQ7XKHOAHTUJKQLPBD1/pascal-muller-wFUyCqW9tS4-unsplash-2.jpg",
        "https://media.cnn.com/api/v1/images/stellar/prod/130819142015-cutest-animal-1-fennec-fox.jpg?q=w_1110,c_fill",
        "https://media.cnn.com/api/v1/images/stellar/prod/130819142032-cutest-animal-4-harp-seal.jpg?q=w_1110,c_fill",
        "https://i.ytimg.com/vi/00a55xsM4lc/hq720.jpg?sqp=-oaymwEhCK4FEIIDSFryq4qpAxMIARUAAAAAGAElAADIQj0AgKJD&rs=AOn4CLB2g8DNlOLV4WpFG4x9MEt2WRxuZQ",
        "https://www.treehugger.com/thmb/y0lhfhyswEnZIHWdmQXJ-_2d1N4=/1500x0/filters:no_upscale():max_bytes(150000):strip_icc()/backlit-cheetah-cubs-in-ndutu-conservation-area--tanzania--east-africa-1203982703-fb64f9e943714215b031adc2f8481d60.jpg",
        "https://cdn.mos.cms.futurecdn.net/HpyDPMwASss4gMdhpLBgpC.jpg",
        "https://d2rdhxfof4qmbb.cloudfront.net/wp-content/uploads/20230315092858/Red-Panda-wallpapersafari.com_.jpg",
        "https://ultimatekilimanjaro.com/wp-content/uploads/2024/01/cuteanimal01.jpg",
        "https://c02.purpledshub.com/uploads/sites/41/2024/05/Red-Panda.jpg",
        "https://i.ytimg.com/vi/WZpisQ0moT4/hq720.jpg?sqp=-oaymwEhCK4FEIIDSFryq4qpAxMIARUAAAAAGAElAADIQj0AgKJD&rs=AOn4CLAexqDR1H3dsYYCKzfezcTQdCWmIg",
        "https://thegoodnewshub.com/wp-content/uploads/2022/03/speckled-cape-tortoise.jpg",
        "https://media.hswstatic.com/eyJidWNrZXQiOiJjb250ZW50Lmhzd3N0YXRpYy5jb20iLCJrZXkiOiJnaWZcL2dldHR5aW1hZ2VzLTE3MTQwMTkyMS5qcGciLCJlZGl0cyI6eyJyZXNpemUiOnsid2lkdGgiOjgyOH19fQ==",
        "https://ultimatekilimanjaro.com/wp-content/uploads/2024/01/cuteanimals22.jpg",
        "https://media.cntraveller.com/photos/611bf05adb797d0116fd4e06/master/w_1024%2Cc_limit/margay-gettyimages-1136682032.jpg",
        "https://static.boredpanda.com/blog/wp-content/uploads/2014/03/cute-fluffy-animals-coverimage.jpg",
        "https://d2rdhxfof4qmbb.cloudfront.net/wp-content/uploads/2023/03/Main.jpg",
        "https://static.independent.co.uk/s3fs-public/thumbnails/image/2013/01/24/12/v2-cute-cat-picture.jpg",
        "https://img.buzzfeed.com/buzzfeed-static/static/2023-10/5/20/asset/e5aedefdeecb/sub-buzz-1322-1696537165-2.jpg?downsize=700%3A%2A&output-quality=auto&output-format=auto",
        "https://images.indianexpress.com/2024/12/9_315c9c.png",
        "https://s.abcnews.com/images/International/panda1-sh-ml-191114_sl_18x13_1600.jpg?w=1600",
        "https://i.ytimg.com/vi/ytBfqBbIoWU/hq720.jpg?sqp=-oaymwEhCK4FEIIDSFryq4qpAxMIARUAAAAAGAElAADIQj0AgKJD&rs=AOn4CLAwmgXxqXu_ScAGfIA81nroqVtd5w",
        "https://static.vecteezy.com/system/resources/thumbnails/055/100/415/small/adorable-baby-dik-dik-close-up-portrait-photo.jpg",
        "https://ultimatekilimanjaro.com/wp-content/uploads/2024/01/cuteanimals11.jpg",
        "https://media.hswstatic.com/eyJidWNrZXQiOiJjb250ZW50Lmhzd3N0YXRpYy5jb20iLCJrZXkiOiJnaWZcL2dldHR5aW1hZ2VzLTEyMTg3NjY3NzEuanBnIiwiZWRpdHMiOnsicmVzaXplIjp7IndpZHRoIjo4Mjh9fX0=",
        "https://thumbs.dreamstime.com/b/baby-rabbit-eating-grass-outdoor-sunny-summer-day-easter-bunny-garden-home-pet-kid-cute-pets-animals-family-131767995.jpg",
        "https://ultimatekilimanjaro.com/wp-content/uploads/2024/01/cuteanimals20.jpg",
        "https://ichef.bbci.co.uk/images/ic/1200x675/p0hjd8f0.jpg",
        "https://i.natgeofe.com/n/f2bd66d6-699c-43fd-8e44-68f8e70b413f/h_27.RTS17H2T8.jpg",
        "https://newsfeed.time.com/wp-content/uploads/sites/9/2012/08/2012-08-14t115243z_10871317.jpg?w=720&h=480&crop=1",
        "https://s.abcnews.com/images/International/snow-leopard-cubs1-rt-ml-191004_sl_3x2_1600.jpg?w=1600",
        "https://cdn.discovermagazine.com/assets/image/57862/meerkat-m.jpg",
        "https://interestingfacts.com/wp-content/uploads/sites/15/2025/07/FEATUREdone_IF_Animals-that-dont-seem-real.jpg",
        "https://ultimatekilimanjaro.com/wp-content/uploads/2024/01/cuteanimals03.jpg",
        "https://images.pexels.com/photos/50577/hedgehog-animal-baby-cute-50577.jpeg?cs=srgb&dl=pexels-pixabay-50577.jpg&fm=jpg",
        "https://www.boredpanda.com/blog/wp-content/uploads/2025/07/readers-vote-help-us-rank-the-cutest-wild-animal-on-earth-cover_675.jpg",
        "https://images.utopia.org/VvdSmd3mpwVe6Pbcu0UY75LQReymQ_N8_MUz8pHsU38/rt:fill/w:1152/h:864/g:ce/plain/2022/08/cutest-exotic-animals-photo-cc0-public-domain-unsplash-iqbal-muakhi-220826.jpg",
        "https://media.istockphoto.com/id/586714878/photo/cute-baby-piglet.jpg?s=612x612&w=0&k=20&c=eR79RWnj_hKVY7XAfPcwnlx4eO1k8LXb5JVnmA3BD3w=",
        "https://www.usatoday.com/gcdn/presto/2020/03/23/USAT/f0623acd-fafa-4177-8035-f32d213a30e2-AFP_1153955091.jpg",
        "https://c02.purpledshub.com/uploads/sites/41/2024/05/Quokka.jpg",
        "https://compote.slate.com/images/73f0857e-2a1a-4fea-b97a-bd4c241c01f5.jpg",
        "https://www.planetnatural.com/wp-content/uploads/2023/06/meerkat-compressed.jpg",
        "https://media.hswstatic.com/eyJidWNrZXQiOiJjb250ZW50Lmhzd3N0YXRpYy5jb20iLCJrZXkiOiJnaWZcL2dldHR5aW1hZ2VzLTUyMjYwMzg3Mi5qcGciLCJlZGl0cyI6eyJyZXNpemUiOnsid2lkdGgiOjgyOH19fQ==",
        "https://media.cntraveller.com/photos/611bf05c36358776d9492a74/4:3/w_2400,h_1800,c_limit/cute.jpg",
        "https://cdn.mos.cms.futurecdn.net/xqWBEzgz3dh66oQqbRxrvg.jpg",
        "https://media.istockphoto.com/id/679868086/photo/best-friends-bunny-rabbit-and-chick-are-kissing.jpg?s=612x612&w=0&k=20&c=ZwOT041dXR8YWngStdLpK5HtZaiDfBRU05sme5hcyoE=",
        "https://c02.purpledshub.com/uploads/sites/41/2024/05/Bush-Baby-Galago-1.jpg?webp=1&w=1200",
        "https://outforia.com/wp-content/uploads/2023/04/cute-animals-1-04042023.jpg",
        "https://s.abcnews.com/images/International/baby-tiger-01-ap-jef-190729_sl_16x11_1600.jpg?w=1600",
        "https://img.buzzfeed.com/buzzfeed-static/static/2019-10/30/19/asset/a919f5846374/sub-buzz-1822-1572463478-1.jpg",
        "https://loveincorporated.blob.core.windows.net/contentimages/gallery/bbab3875-550b-4445-ab96-f4699b2b43da-meerkat-worlds-cutest-baby-animals-ranked.jpg",
        "https://static.scientificamerican.com/dam/m/120f13fd81870c89/original/GettyImages-1469738306.jpg?m=1733930601.637&w=600",
        "https://i.natgeofe.com/n/debcdb20-9c86-48a1-85c2-d49b577581d4/02-waq-strange-cute-animals.jpg",
        "https://cdn.thegreatprojects.com/thegreatprojects/uploads/43965b5fa1ae51283b083e1065d4cf55.jpg?format=jpg&width=&height=",
        "https://i.ytimg.com/vi/YJShZ7ht5RU/sddefault.jpg",
        "https://newsfeed.time.com/wp-content/uploads/sites/9/2013/05/rtxz8ei.jpg?w=1000&h=667&crop=1",
        "https://cms.travelnoire.com/cdn-cgi/image/format=auto,slow-connection-quality=30,onerror=redirect/https://cms.travelnoire.com/wp-content/uploads/2024/10/panda-7015575_1280.jpg",
        "https://www.greyhound.com.au/media/7668/echidna.jpg",
        "https://ultimatekilimanjaro.com/wp-content/uploads/2024/01/cuteanimals16.jpg",
        "https://res.cloudinary.com/jerrick/image/upload/d_642250b563292b35f27461a7.png,f_jpg,q_auto,w_720/fwhusdvcgimqkwikfmfd.jpg",
        "https://c02.purpledshub.com/uploads/sites/47/2024/08/European-hedgehog.jpeg?webp=1&w=1200",
        "https://i.natgeofe.com/n/07cebb83-b3c3-4078-8494-734630c9f1a5/08-waq-strange-cute-animals.jpg",
        "https://c02.purpledshub.com/uploads/sites/41/2024/05/Axolotl.jpg?webp=1&w=1200",
        "https://owlcation.com/.image/w_3840,q_auto:good,c_limit/MTc0MzIwMjM1MTk1NjcxOTEy/top-ten-cutest-japanese-wild-animals.jpg?arena_f_auto",
        "https://static.boredpanda.com/blog/wp-content/uploads/2017/03/58bf267f56bc4.png",
        "https://assets3.thrillist.com/v1/image/2538449/792x594/scale;webp=auto;jpeg_quality=60.jpg",
        "https://www.verywellmind.com/thmb/15xUglFOvLnNWygFwRyRiu6nIts=/1500x0/filters:no_upscale():max_bytes(150000):strip_icc()/iStock-619961796-edit-59cabaf6845b3400111119b7.jpg",
        "https://d2rdhxfof4qmbb.cloudfront.net/wp-content/uploads/20230315093428/Fennec-Fox.jpg",
        "https://paradepets.com/.image/w_3840,q_auto:good,c_limit/NTowMDAwMDAwMDAwMTMwNjEz/red-panda-yawning-130613.jpg?arena_f_auto",
        "https://outforia.com/wp-content/uploads/2023/04/cute-animals-31-04042023.jpg",
        "https://somethinginmind.home.blog/wp-content/uploads/2020/10/adorable-1850276_1920-1.jpg?w=1024",
        "https://i.natgeofe.com/k/c9b475a6-b4fe-456d-b58e-c07537ba3ed0/125-Cute-Animals_Cvr_Hires_FINAL_4x3.jpg",
        "https://www.worldatlas.com/r/w1200/upload/3f/51/f4/shutterstock-298711403-1.jpg",
        "https://images.squarespace-cdn.com/content/v1/569ec99b841abaccb7c7e74c/1559673591361-GPGCENO0Y3NVWTHMOIZQ/Fun+Facts+logo+-+adorable+animals.jpg",
        "https://kids.mongabay.com/wp-content/uploads/2021/05/tigers.jpg",
        "https://th-thumbnailer.cdn-si-edu.com/Kyxy0UvRSIPhchYMn7IA4x4PtAg=/1280x720/filters:focal(393x403:394x404)/https://tf-cmsv2-smithsonianmag-media.s3.amazonaws.com/filer/b1/ef/b1ef12c3-d5cd-4c7e-882c-290ffc946a33/greysealpupday2web.jpg",
        "https://static.scientificamerican.com/sciam/cache/file/BA29AE8A-1400-4183-82AB90B7067FAF67_source.jpg?w=600",
        "https://ichef.bbci.co.uk/images/ic/480xn/p0c1bh49.jpg",
        "https://www.cbc.ca/natureofthings/content/legacy/babyanimals_blogpost.jpg",
        "https://s3.animalia.bio/animals/photos/full/1.25x1/uIHfP9glpalZhZDru6CH.webp?id=eaf7b51471e6db51cf684718855570f7",
        "https://paradepets.com/.image/w_3840,q_auto:good,c_limit/MTkxMzY1Nzg4MTM5MjAyMTQ2/Quokka%2520on%2520Rottnest%2520Island%2520-%2520Western%2520Australia.jpg?arena_f_auto",
        "https://loveincorporated.blob.core.windows.net/contentimages/gallery/9830e492-bef5-444a-87f5-27a3fc9a8503-owl-worlds-cutest-baby-animals-ranked.jpg",
        "https://www.queensland.com/au/en/places-to-see/experiences/nature-and-wildlife/cute-baby-animals-at-australia-zoo.thumb.800.480.png",
        "https://media.istockphoto.com/id/1168451046/photo/cat-and-dog-sleeping-puppy-and-kitten-sleep.jpg?s=612x612&w=0&k=20&c=WufdaqZhhwOT6sJFAb6g7-laVoBWaf66XefiWUt44BQ=",
        "https://s.abcnews.com/images/International/baby-red-panda-sh-ml-191114_sl_4x3_1600.jpg?w=1600",
        "https://www.goodnet.org/photos/281x197/33209_hd.jpg",
        "https://media-cldnry.s-nbcnews.com/image/upload/t_fit-1500w,f_auto,q_auto:best/streams/2012/August/120828/505250-pb-110527-baby-swan-ps.jpg",
        "https://www.rd.com/wp-content/uploads/2025/05/Hedgehog-in-the-garden_GettyImages-496545234.jpg"

    ],

    init: function() {
        this.activeImages = [...this.sourceImages];
    },

    startGame: function(mode) {
        this.difficulty = mode;
        this.score = 0;
        this.questionNumber = 0;
        this.isProcessing = false;
        
        document.getElementById('score-display').innerText = this.score;
        this.showScreen('game-screen');
        this.nextQuestion();
    },

    resetToTitle: function() {
        this.showScreen('title-screen');
    },

    showScreen: function(id) {
        document.querySelectorAll('.screen').forEach(el => el.classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
        window.scrollTo(0,0);
    },

    // --- DIAGNOSTICS & MANAGEMENT ---

    openDiagnostics: function() {
        this.showScreen('diagnostic-screen');
        const container = document.getElementById('gallery-container');
        container.innerHTML = '';
        const countDisplay = document.getElementById('diag-count');

        this.activeImages = []; 
        
        this.sourceImages.forEach((url, index) => {
            const div = document.createElement('div');
            div.className = 'gallery-item';
            
            const img = document.createElement('img');
            img.src = url;
            
            img.onload = () => {
                div.classList.add('good');
                this.activeImages.push(url);
                countDisplay.innerText = this.activeImages.length;
            };
            
            img.onerror = () => {
                div.classList.add('bad');
                img.style.display = 'none';
                div.innerHTML = '<span style="color:red; font-size:20px; position:absolute; top:50%; left:50%; transform:translate(-50%,-50%)">‚ùå</span>';
            };

            div.appendChild(img);
            container.appendChild(div);
        });
    },

    // --- MATH LOGIC ---

    getRandomInt: function(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
    },

    generateQuestion: function() {
        let n1, n2, operator, answer;
        const isAddition = Math.random() > 0.5;

        if (this.difficulty === 'easy') {
            n1 = this.getRandomInt(1, 3);
            n2 = this.getRandomInt(1, 9);
        } else {
            n1 = this.getRandomInt(1, 10);
            n2 = this.getRandomInt(1, 10);
        }

        if (isAddition) {
            operator = '+';
            answer = n1 + n2;
        } else {
            operator = '-';
            if (n2 > n1) { [n1, n2] = [n2, n1]; }
            answer = n1 - n2;
        }

        return { text: `${n1} ${operator} ${n2} = ?`, correctAnswer: answer };
    },

    generateAnswers: function(correct) {
        let answers = new Set();
        answers.add(correct);
        while (answers.size < 4) {
            let offset = this.getRandomInt(-3, 3);
            let wrong = correct + offset;
            if (wrong >= 0 && wrong !== correct) {
                answers.add(wrong);
            } else if (wrong < 0) {
                answers.add(this.getRandomInt(0, 10));
            }
        }
        return Array.from(answers).sort(() => Math.random() - 0.5);
    },

    nextQuestion: function() {
        if (this.questionNumber >= this.maxQuestions) {
            this.endGame();
            return;
        }
        this.questionNumber++;
        this.firstAttempt = true; // Reset attempt flag
        document.getElementById('feedback-msg').classList.add('hidden'); // Hide oops msg
        
        document.getElementById('q-count').innerText = this.questionNumber;
        
        this.currentQuestion = this.generateQuestion();
        const choices = this.generateAnswers(this.currentQuestion.correctAnswer);

        document.getElementById('question-text').innerText = this.currentQuestion.text;
        
        const container = document.getElementById('answers-container');
        container.innerHTML = ''; 

        choices.forEach(choice => {
            const btn = document.createElement('button');
            btn.className = 'answer-btn';
            btn.innerText = choice;
            btn.onclick = () => this.checkAnswer(choice);
            container.appendChild(btn);
        });
        this.isProcessing = false;
    },

    checkAnswer: function(selectedVal) {
        if (this.isProcessing) return;

        if (selectedVal === this.currentQuestion.correctAnswer) {
            // Correct Answer!
            this.isProcessing = true; // Lock input
            
            // Only award point on first attempt
            if (this.firstAttempt) {
                this.score++;
                document.getElementById('score-display').innerText = this.score;
            }
            
            // Hide oops message just in case
            document.getElementById('feedback-msg').classList.add('hidden');
            this.showFeedback();
            
        } else {
            // Incorrect Answer
            this.firstAttempt = false; // Mark question as "dirty" (no points allowed)
            const msg = document.getElementById('feedback-msg');
            msg.classList.remove('hidden');
            
            // Re-trigger shake animation
            msg.style.animation = 'none';
            msg.offsetHeight; /* trigger reflow */
            msg.style.animation = 'shake 0.5s';
        }
    },

    showFeedback: function() {
        if (this.activeImages.length === 0) {
            this.activeImages = [...this.sourceImages]; 
        }

        const randomImg = this.activeImages[Math.floor(Math.random() * this.activeImages.length)];
        const imgEl = document.getElementById('animal-display');
        imgEl.src = "";
        imgEl.src = randomImg;
        this.showScreen('feedback-screen');

        setTimeout(() => {
            this.showScreen('game-screen');
            this.nextQuestion();
        }, 3000);
    },

    handleImageError: function(imgEl) {
        const brokenUrl = imgEl.src;
        this.activeImages = this.activeImages.filter(u => u !== brokenUrl);
        
        if (this.activeImages.length > 0) {
            const nextImg = this.activeImages[Math.floor(Math.random() * this.activeImages.length)];
            imgEl.src = nextImg;
        } else {
            imgEl.style.display = 'none';
        }
    },

    endGame: function() {
        document.getElementById('final-score').innerText = this.score;
        this.showScreen('end-screen');
    }
};

game.init();
</script>

</body>
</html>
